
2.1 Communications.py
""" DOCS: https://abb-robot-machine-vision.readthedocs.io/en/latest/
https://developercenter.robotstudio.com/api/rwsApi/"""

import time
import json
from rwsuis import RWS
import requests
from requests.auth import HTTPDigestAuth

# Constants
NORBERT_ADDRESS = "http://152.94.0.38"
RUDOLF_ADDRESS = "http://152.94.0.39"

def test_get_request(robot_ip: str) -> bool:
"""Makes attempt to poll controller state, returns true or false
depending on success"""
# Username and password for robots
auth = HTTPDigestAuth("Default User", "robotics")
# Returns xml unless specified
r = requests.get(f"{robot_ip}/rw/panel/ctrlstate?json=1", auth=auth)
# Test out json lib
json_response = r.json()
pretty_response = json.dumps(json_response, indent=4)
if r.status_code >= 200 and r.status_code < 300:
print(f"Success: {r.status_code}")
print(pretty_response)
return True
else:
print(f"Unsuccessfull: {r.status_code}")
print(pretty_response)
return False

def request_mastership(robot_ip: str, manual: bool = False) -> RWS.RWS:
"""Tries to request mastership of robot"""
robot = RWS.RWS(robot_ip)
if manual:
robot.request_rmmp() # Mastership request in manual mode
time.sleep(3) # Give time to accept manual request
else:
robot.request_mastership() # Mastership request in automatic mode
return robot


def test_post_request(robot_ip: str, variable_name: str, new_robtarget:
list[int]) -> None:
robot = request_mastership(robot_ip, True)
robot.set_robtarget_translation(variable_name, new_robtarget)

if __name__ == "__main__":
# test_get_request(NORBERT_ADDRESS)
#test_post_request(NORBERT_ADDRESS, "simple_robtarget", [0, 0, 400])
norbert = RWS.RWS(NORBERT_ADDRESS) # Norbertâ€™s IP address
norbert.request_mastership()
norbert.motors_on()
norbert.start_RAPID() # NB! Starts RAPID execution from main
norbert.set_robtarget_translation("simple_robtarget", [0,0,400])


# # Create session
# robot = RWS.RWS(NORBERT_ADDRESS)

# # Get variables
# robot.get_rapid_variable("variablename")

# # Execute commands:
# robot.set_rapid_variable("variablename", 1)
